
## DO NOT EDIT THIS FILE ##
# This file is automatically generated by sc-jsonnet. To modify,
# edit snapcraft.jsonnet and run sc-jsonnet (from the snap store).
adopt-info: cawbird
apps:
  cawbird:
    command: bin/check-ld-cache $SNAP/usr/bin/cawbird
    command-chain:
    - snap/command-chain/alsa-launch
    common-id: uk.co.ibboard.cawbird.desktop
    desktop: usr/share/applications/cawbird.desktop
    extensions:
    - gnome-3-28
    plugs:
    - audio-playback
    - desktop
    - desktop-legacy
    - gsettings
    - home
    - network
    - opengl
    - pulseaudio
    - unity7
    - wayland
    - x11
base: core18
confinement: strict
description: "Cawbird is a modern and lightweight Twitter client for the GNOME 3 desktop.\
  \ It\nfeatures inline image and video preview, creation of lists and favorites,\n\
  filtering of tweets and full text search. Cawbird is able to manage multiple\nTwitter\
  \ accounts.\n\nCawbird is a fork of Corebird, which became unsupported after Twitter\
  \ disabled\nthe streaming API. Cawbird works with the new APIs and includes a few\
  \ fixes\nand modifications that have historically been patched in to IBBoard's custom\n\
  Corebird build on his personal Open Build Service account[1].\n\nDue to changes\
  \ in the Twitter API[2], Cawbird has the following limitations:\n\n- Cawbird will\
  \ update every two minutes\n- Cawbird does not get notified of the following, which\
  \ will be refreshed on\nrestart:\n    - Unfavourite\n    - Follow/Unfollow\n   \
  \ - Block/Unblock\n    - Mute/Unmute\n    - DM deletion\n    - Some list changes\n\
  \nAll limitations are limitations imposed by Twitter and are not the fault of the\n\
  Cawbird client.\n\n[1]: https://build.opensuse.org/project/show/home:IBBoard:desktop\n\
  [2]: https://developer.twitter.com/en/docs/accounts-and-users/subscribe-account-activity/migration/introduction"
environment:
  FINAL_BINARY: $SNAP/usr/bin/cawbird
  LD_LIBRARY_PATH: $LD_LIBRARY_PATH:$SNAP/gnome-platform/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
grade: stable
layout:
  /etc/ld.so.cache:
    bind-file: $SNAP_DATA/etc/ld.so.cache
  /usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib:
    bind: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
  /usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gstreamer-1.0:
    bind: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gstreamer-1.0
name: cawbird
parts:
  alsa-mixin:
    after: []
    build-packages:
    - libasound2-dev
    override-build: 'set -eux

      install -m644 -D -t "$SNAPCRAFT_PART_INSTALL/etc" asound.conf

      install -m755 -D -t "$SNAPCRAFT_PART_INSTALL/snap/command-chain" alsa-launch

      '
    override-pull: "set -eux\ncat > asound.conf <<EOF\npcm.!default {\n    type pulse\n\
      \    fallback \"sysdefault\"\n    hint {\n        show on\n        description\
      \ \"Default ALSA Output (currently PulseAudio Sound Server)\"\n    }\n}\nctl.!default\
      \ {\n    type pulse\n    fallback \"sysdefault\"\n}\nEOF\ncat > alsa-launch\
      \ <<EOF\n#!/bin/bash\nexport ALSA_CONFIG_PATH=\"\\$SNAP/etc/asound.conf\"\n\n\
      if [ -d \"\\$SNAP/usr/lib/alsa-lib\" ]; then\n    export LD_LIBRARY_PATH=\"\\\
      $LD_LIBRARY_PATH:\\$SNAP/usr/lib/alsa-lib\"\nelif [ -d \"\\$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib\"\
      \ ]; then\n    export LD_LIBRARY_PATH=\"\\$LD_LIBRARY_PATH:\\$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib\"\
      \nfi\nexport LD_LIBRARY_PATH=\"\\$LD_LIBRARY_PATH:\\$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/pulseaudio\"\
      \n\n# Make PulseAudio socket available inside the snap-specific \\$XDG_RUNTIME_DIR\n\
      if [ -n \"\\$XDG_RUNTIME_DIR\" ]; then\n    pulsenative=\"pulse/native\"\n \
      \   pulseaudio_sockpath=\"\\$XDG_RUNTIME_DIR/../\\$pulsenative\"\n    if [ -S\
      \ \"\\$pulseaudio_sockpath\" ]; then\n        export PULSE_SERVER=\"unix:\\\
      ${pulseaudio_sockpath}\"\n    fi\nfi\n\nexec \"\\$@\"\nEOF\nchmod +x alsa-launch\n"
    plugin: nil
    source: https://github.com/diddledan/snapcraft-alsa.git
    stage-packages:
    - libasound2
    - libasound2-plugins
  cawbird:
    after:
    - alsa-mixin
    build-packages:
    - gettext
    - libgstreamer-plugins-bad1.0-dev
    - libgstreamer-plugins-good1.0-dev
    - libgspell-1-dev
    - libgstreamer1.0-dev
    - libjson-glib-dev
    - libsoup2.4-dev
    - libsqlite3-dev
    - libxml2-utils
    - locales-all
    - valac
    meson-parameters:
    - -Dprefix=/usr
    override-pull: '

      snapcraftctl pull


      git checkout "$(git describe --tags --abbrev=0 --match ''v*'')"

      snapcraftctl set-version "$(git describe --tags | sed -e ''s|^v||'')"


      sed -i ''s|^Icon=.*|Icon=/usr/share/icons/hicolor/scalable/apps/uk.co.ibboard.cawbird.svg|''
      data/uk.co.ibboard.cawbird.desktop.in

      '
    parse-info:
    - usr/share/metainfo/uk.co.ibboard.cawbird.appdata.xml
    plugin: meson
    source: https://github.com/ibboard/cawbird.git
    stage:
    - -usr/share/alsa
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/libasound*
    stage-packages:
    - gstreamer1.0-gtk3
    - gstreamer1.0-libav
    - gstreamer1.0-plugins-bad
    - gstreamer1.0-plugins-base
    - gstreamer1.0-plugins-good
    - gstreamer1.0-pulseaudio
    - gstreamer1.0-tools
    - gstreamer1.0-vaapi
    - libgstreamer1.0-0
  cleanup:
    after:
    - alsa-mixin
    - cawbird
    - desktop-settings-build
    - desktop-settings-packages
    - gtk-locales
    - scripts
    build-snaps:
    - core18
    - gtk-common-themes
    - gnome-3-28-1804
    override-prime: 'set -eux

      cd "/snap/core18/current"

      find . -type f,l -exec rm -f "$SNAPCRAFT_PRIME/{}" \;


      cd "/snap/gtk-common-themes/current"

      find . -type f,l -exec rm -f "$SNAPCRAFT_PRIME/{}" \;


      cd "/snap/gnome-3-28-1804/current"

      find . -type f,l -exec rm -f "$SNAPCRAFT_PRIME/{}" \;



      '
    plugin: nil
  desktop-settings-build:
    after:
    - alsa-mixin
    - cawbird
    - desktop-settings-packages
    - scripts
    build-packages: []
    override-prime: 'set -eux

      glib-compile-schemas usr/share/glib-2.0/schemas

      '
    plugin: nil
    stage:
    - -usr/share/alsa
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/libasound*
    stage-packages: []
  desktop-settings-packages:
    after:
    - alsa-mixin
    - gnome-extension
    build-packages:
    - libglib2.0-bin
    plugin: nil
    prime:
    - usr/share/glib-2.0/schemas/*
    stage:
    - -usr/share/alsa
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/libasound*
    stage-packages:
    - gsettings-desktop-schemas
    - ubuntu-settings
  gtk-locales:
    after:
    - alsa-mixin
    - cawbird
    - desktop-settings-build
    - desktop-settings-packages
    - scripts
    build-packages:
    - apt
    - dpkg
    override-build: 'set -eux

      for deb in *.deb; do dpkg-deb -x $deb .; done

      find usr/share/locale-langpack -type f -not -name "gtk30*.mo" -exec rm ''{}''
      \;

      mkdir -p "$SNAPCRAFT_PART_INSTALL/usr/share"

      cp -R usr/share/locale-langpack "$SNAPCRAFT_PART_INSTALL/usr/share/"

      '
    override-pull: 'set -eux

      apt download "language-pack-gnome-*-base"

      '
    plugin: nil
    stage:
    - -usr/share/alsa
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/libasound*
    stage-packages: []
  scripts:
    after:
    - alsa-mixin
    build-packages: []
    organize:
      build-ld-cache: bin/build-ld-cache
      check-ld-cache: bin/check-ld-cache
    plugin: dump
    source: scripts
    stage:
    - -usr/share/alsa
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib
    - -usr/lib/$SNAPCRAFT_ARCH_TRIPLET/libasound*
    stage-packages: []
slots:
  dbus-cawbird:
    bus: session
    interface: dbus
    name: uk.co.ibboard.cawbird
summary: Cawbird Twitter Client (Corebird fork)
